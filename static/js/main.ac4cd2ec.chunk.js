(this["webpackJsonpdash-web"]=this["webpackJsonpdash-web"]||[]).push([[0],{266:function(e,t,n){},285:function(e,t,n){},324:function(e,t){},326:function(e,t){},358:function(e,t){},360:function(e,t){},395:function(e,t,n){},403:function(e,t,n){},405:function(e,t,n){},406:function(e,t,n){},427:function(e,t,n){},428:function(e,t,n){},429:function(e,t,n){},544:function(e,t,n){},545:function(e,t,n){},546:function(e,t,n){},547:function(e,t,n){},548:function(e,t,n){"use strict";n.r(t);var c=n(16),a=n(60),i=n(72),s=n(9),r=n(7),o=n(0),d=n(113),l=n(567),u=n(556),j=n(573),b=n(568),h=n(569),f=n(570),m=n(571),O=(n(266),n(554)),p=n(555),v=n(17),g=n.n(v);function x(){if(localStorage.getItem("user")){var e=JSON.parse(localStorage.getItem("user")||"");return e&&e.accessToken?{headers:{Authorization:"Bearer "+e.accessToken,"Content-type":"application/json"}}:{}}return{}}var w=n(1);function k(e){var t=Object(o.useState)(e.tab.label),n=Object(r.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)(!1),s=Object(r.a)(i,2),d=s[0],l=s[1];return Object(w.jsx)(O.a,{className:"clickableItem",children:Object(w.jsx)(p.a,{onClick:e.onTabClicked,children:d?Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)("input",{onDoubleClick:function(){(function(e,t,n){return g.a.post("".concat("https://dash-webservices.herokuapp.com","/tab/updateTab"),{id:e,label:t,tabOrder:n},x())})(e.tab.id,c,e.tab.tabOrder).then((function(){l(!d)}))},onChange:function(e){return a(e.target.value)},value:c}),Object(w.jsx)(u.a,{className:"deleteTabButton",onClick:function(){var t;(t=e.tab.id,g.a.delete("".concat("https://dash-webservices.herokuapp.com","/tab/deleteTab/?id=").concat(t),x())).then((function(){return e.onTabDeleted(e.tab.id)}))},children:Object(w.jsx)("i",{className:"fa fa-trash"})})]}):Object(w.jsx)("span",{onDoubleClick:function(){l(!d)},children:c})})},e.tab.id)}var y={"Content-type":"application/json"};var N={login:function(e,t){return g.a.post("".concat("https://dash-webservices.herokuapp.com","/auth/login"),{username:e,password:t},{headers:y}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data}))},logout:function(){localStorage.removeItem("user"),window.location.reload()},getCurrentUser:function(){if(localStorage.getItem("user"))return JSON.parse(localStorage.getItem("user")||"")}};function S(){var e=Object(o.useState)(""),t=Object(r.a)(e,2),n=t[0],c=t[1],a=Object(o.useState)(""),i=Object(r.a)(a,2),s=i[0],d=i[1],l=Object(o.useState)(!1),u=Object(r.a)(l,2),j=u[0],b=u[1],h=Object(o.useState)(""),f=Object(r.a)(h,2),m=f[0],O=f[1];return Object(w.jsx)("div",{className:"col-md-12",children:Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{className:"form-group",children:[Object(w.jsx)("label",{htmlFor:"username",children:"Username"}),Object(w.jsx)("input",{id:"inputUsername",type:"text",className:"form-control",name:"username",value:n,onChange:function(e){c(e.target.value)}})]}),Object(w.jsxs)("div",{className:"form-group",children:[Object(w.jsx)("label",{htmlFor:"password",children:"Password"}),Object(w.jsx)("input",{id:"inputPassword",type:"password",className:"form-control",name:"password",value:s,onChange:function(e){d(e.target.value)}})]}),Object(w.jsx)("div",{className:"form-group",children:Object(w.jsxs)("button",{id:"loginButton",disabled:!n||!s||j,onClick:function(){O(""),b(!0),n&&s?N.login(n,s).then((function(){window.location.reload(),b(!1)}),(function(e){var t=e.response&&e.response.data&&e.response.data.message||e.message||e.toString();b(!1),O(t)})):b(!1)},className:"btn btn-success btn-block",children:[j&&Object(w.jsx)("span",{className:"spinner-border spinner-border-sm"}),Object(w.jsx)("span",{children:"Se connecter"})]})}),m&&Object(w.jsx)("div",{className:"form-group",children:Object(w.jsx)("div",{className:"alert alert-danger",role:"alert",children:m})})]})})}var C,D=n(557),E=n(558),R=n(559),_=n(560),A=n(561),T=n(562);!function(e){e[e.WEATHER=1]="WEATHER",e[e.RSS=2]="RSS",e[e.CALENDAR=3]="CALENDAR",e[e.STRAVA=4]="STRAVA",e[e.STEAM=5]="STEAM"}(C||(C={}));var B=function(e){return Object(w.jsx)("div",{className:"flexRow",children:Object.keys(C).map((function(t){return isNaN(parseInt(t,0))&&Object(w.jsxs)(D.a,{children:[Object(w.jsx)(E.a,{top:!0,width:"100%",src:"/assets/318x180.svg",alt:"Card image cap"}),Object(w.jsxs)(R.a,{children:[Object(w.jsx)(_.a,{children:t}),Object(w.jsxs)(A.a,{children:["Widget ",t]}),Object(w.jsxs)(T.a,{children:["Cliquez ci-dessous pour ajouter un widget ",t," au dashboard."]}),Object(w.jsx)(u.a,{id:t,onClick:e.onWidgetAdded,className:"btn btn-success",value:C[t],children:"Ajouter"})]})]},t)}))})},I="TOGGLE_TAB",L=function(e){return{type:I,payload:{id:e}}};function M(e,t){return g.a.post("".concat("https://dash-webservices.herokuapp.com","/widget/updateWidgetData"),{id:e,data:t},x())}var W=n(566),F=n(10),z=n(11),U=n(20),H=n(19),P=n(23),G=(n(285),function(e){return Object(w.jsx)("div",{children:Object(w.jsx)(i.a,{children:Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{className:"tabContainer",children:e.tabList.map((function(e){return Object(w.jsx)("div",{children:Object(w.jsx)(i.b,{to:e.path,children:e.title})},e.title)}))}),Object(w.jsx)("div",{children:e.tabList.map((function(e){return Object(w.jsx)("div",{children:Object(w.jsx)(P.a,{path:e.path,exact:e.exact,component:e.component})},e.title)}))})]})})})}),V=n(75),Y=V.createLogger({format:V.format.combine(V.format.json(),V.format.colorize({all:!0})),level:"debug",transports:[new V.transports.Console]});var q,J=[{title:"Groupes",component:function(){return Object(o.useEffect)((function(){new Promise((function(e,t){Y.debug("getGroupsData"),FB.api("/me/groups",{fields:"administrator,bookmark_order,id,unread,cover,created_time,description,icon,email,link,name,purpose,venue,picture"},(function(n){n?e(n):t(Error("Promise rejected"))}))})).then((function(e){Y.debug(e)})).catch((function(e){Y.debug(e)}))}),[]),Object(w.jsx)("div",{children:"Liste des groupes auxquels vous appartenez"})},path:"/groups/"},{title:"Events",component:function(){return Object(o.useEffect)((function(){Y.debug("onComponentDidMount")})),Object(w.jsx)("div",{children:"Liste des prochains \xe9v\xe8nements"})},path:"/events/"}],K=function(e){Object(U.a)(n,e);var t=Object(H.a)(n);function n(e){var c;return Object(F.a)(this,n),(c=t.call(this,e)).checkLoginStatus=function(){FB.getLoginStatus(c.facebookLoginHandler)},c.facebookLogin=function(){Y.debug("facebookLogin"),FB.getLoginStatus((function(e){Y.debug(e),c.setState({loginStatusResponse:e}),"connected"!==e.status&&FB.login(c.facebookLoginHandler,{scope:"user_birthday,user_hometown,user_likes,user_photos,user_friends,user_status,user_tagged_places,user_posts,user_gender,user_link,email,public_profile"})}))},c.facebookLogout=function(){FB.logout((function(e){Y.debug(e),c.setState({userData:void 0,loginStatusResponse:e})}))},c.facebookLoginHandler=function(e){Y.debug("facebookLoginHandler"),c.setState({loginStatusResponse:e}),"connected"===e.status&&(Y.debug("Connected"),new Promise((function(e,t){Y.debug("getProfile"),FB.api("/me",{fields:"id,first_name,last_name,hometown,location,birthday,gender,link"},(function(n){n?e(n):t(Error("Promise rejected"))}))})).then((function(e){Y.debug("Result"),Y.debug(e),c.setState({userData:e})})).catch((function(e){Y.debug(e)})))},window.fbAsyncInit=function(){FB.init({appId:e.appId,xfbml:!0,version:"v3.2"});var t=new Event("FBObjectReady");document.dispatchEvent(t)},function(e,t,n){var c=e.getElementsByTagName(t)[0],a=e.getElementsByTagName(t)[0];e.getElementById(n)||((c=e.createElement(t)).id=n,c.src="https://connect.facebook.net/en_US/sdk.js",a&&a.parentNode&&a.parentNode.insertBefore(c,a))}(document,"script","facebook-jssdk"),document.addEventListener("FBObjectReady",c.checkLoginStatus),c}return Object(z.a)(n,[{key:"componentWillUnmount",value:function(){document.removeEventListener("FBObjectReady",this.checkLoginStatus)}},{key:"render",value:function(){var e=null;if(this.state&&this.state.loginStatusResponse&&"connected"===this.state.loginStatusResponse.status&&this.state.userData){var t=this.state.userData;e=Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{children:[t.first_name," ",t.last_name]}),Object(w.jsx)("div",{onClick:this.facebookLogout,children:"Se d\xe9connecter"})]})}else e=Object(w.jsx)("div",{onClick:this.facebookLogin,className:"fb-login-button","data-max-rows":"1","data-size":"large","data-button-type":"continue_with","data-use-continue-as":"true"});return Object(w.jsxs)("div",{children:[e,this.state&&this.state.userData&&Object(w.jsx)("div",{children:Object(w.jsx)(G,{tabList:J})})]})}}]),n}(o.Component),Q=n(563);n(395);function $(e){var t=Object(o.useState)(!1),n=Object(r.a)(t,2),c=n[0],a=n[1];return Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{onClick:function(){a(!c)},className:"title",children:e.componentRoot}),Object(w.jsx)("div",{children:Object(w.jsx)(Q.a,{isOpen:c,children:Object(w.jsx)(D.a,{children:Object(w.jsx)(R.a,{children:c&&e.componentDetail&&e.componentDetail})})})})]})}function X(e){return Object(w.jsxs)("div",{children:[Object(w.jsx)("h4",{children:"\xcates-vous s\xfbr de vouloir supprimer ce widget ?"}),Object(w.jsx)("button",{onClick:e.onCancelButtonClicked,className:"btn btn-primary cancelButton",children:"Annuler"}),Object(w.jsx)("button",{onClick:function(){e.onDeleteButtonClicked(e.idWidget)},className:"btn btn-danger validateDeletionButton",children:"Supprimer"})]})}function Z(e){var t=Object(o.useState)(q.READ),n=Object(r.a)(t,2),c=n[0],a=n[1];return Object(o.useEffect)((function(){a(q.READ)}),[e.config]),Object(w.jsx)("div",{children:c===q.READ?Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{className:"header",children:[Object(w.jsx)("div",{className:"leftGroup widgetHeader",children:e.header}),Object(w.jsxs)("div",{className:"rightGroup",children:[e.editModeComponent&&Object(w.jsx)("button",{onClick:function(){e.editModeComponent&&a(q.EDIT)},className:"btn btn-default editButton",children:Object(w.jsx)("i",{className:"fa fa-cog","aria-hidden":"true"})}),Object(w.jsx)("button",{onClick:e.refreshFunction,className:"btn btn-default refreshButton",children:Object(w.jsx)("i",{className:"fa fa-refresh","aria-hidden":"true"})}),Object(w.jsx)("button",{onClick:function(){a(q.DELETE)},className:"btn btn-default deleteButton",children:Object(w.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})})]})]}),e.body]}):c===q.DELETE?Object(w.jsx)(X,{idWidget:e.id,onDeleteButtonClicked:e.onDeleteButtonClicked,onCancelButtonClicked:function(){a(q.READ)}}):e.editModeComponent?e.editModeComponent:function(){return a(q.READ)}})}!function(e){e[e.READ=1]="READ",e[e.EDIT=2]="EDIT",e[e.DELETE=3]="DELETE"}(q||(q={}));n(403);function ee(e){return(e/100*360).toString()}var te=function(e){return Object(w.jsxs)("div",{className:"progress mx-auto",children:[Object(w.jsx)("span",{className:"progressLeft",children:Object(w.jsx)("span",{style:{transform:e.value>50?"rotate(".concat(ee(e.value-50),"deg)"):"unset"},className:"progressBar border-primary"})}),Object(w.jsx)("span",{className:"progressRight",children:Object(w.jsx)("span",{style:{transform:e.value>50?"rotate(180deg)":"rotate(".concat(ee(e.value),"deg)")},className:"progressBar border-primary"})}),Object(w.jsx)("div",{className:"progressValue w-100 h-100 rounded-circle d-flex align-items-center justify-content-center",children:Object(w.jsxs)("div",{className:"h2 font-weight-bold",children:[Math.round(e.value),"%"]})})]})};function ne(e){var t=Object(o.useState)([]),n=Object(r.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)([]),d=Object(r.a)(i,2),l=d[0],u=d[1],j="".concat("https://api.steampowered.com","/ISteamUserStats/GetPlayerAchievements/v0001/?appid=").concat(e.appid,"&key=").concat("A326F74CDA403B3E1135FAFADC9EEF66","&steamid=").concat("76561198046131373");return Object(o.useEffect)((function(){g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/"),Object(s.a)(Object(s.a)({},x()),{},{params:{url:j}})).then((function(e){e.data.playerstats.achievements&&(a(e.data.playerstats.achievements),u(e.data.playerstats.achievements.filter((function(e){return 1===e.achieved}))))}))}),[e]),Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)("div",{children:e.name}),Object(w.jsx)("a",{href:"".concat("https://steamcommunity.com/app/").concat(e.appid),children:Object(w.jsx)("img",{src:"".concat("https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/apps/").concat(e.appid,"/").concat(e.img_logo_url,".jpg                  ")})})]}),c&&l&&c.length>0&&Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsxs)("div",{className:"flexColumn",children:[Object(w.jsxs)("div",{className:"totalachievements",children:["Succ\xe8s : ",c.length]}),Object(w.jsxs)("div",{className:"completedAchievements",children:["Succ\xe8s compl\xe9t\xe9s : ",l.length]})]}),Object(w.jsx)(te,{value:l.length/c.length*100})]})]})}function ce(e){var t=Object(o.useState)(),n=Object(r.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)(),d=Object(r.a)(i,2),l=d[0],u=d[1],j="https://api.steampowered.com",b="/ISteamUser/GetPlayerSummaries/v0002/?key=".concat("A326F74CDA403B3E1135FAFADC9EEF66","&steamids=").concat("76561198046131373"),h="/IPlayerService/GetOwnedGames/v0001/?key=".concat("A326F74CDA403B3E1135FAFADC9EEF66","&steamid=").concat("76561198046131373","&format=json&include_appinfo=true");function f(){g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/"),Object(s.a)(Object(s.a)({},x()),{},{params:{url:"".concat(j).concat(b)}})).then((function(e){a(e.data.response.players[0])})).catch((function(e){Y.error(e.message)})),g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/"),Object(s.a)(Object(s.a)({},x()),{},{params:{url:"".concat(j).concat(h)}})).then((function(e){u(e.data.response.games.sort((function(e,t){return e.name.localeCompare(t.name)})))})).catch((function(e){Y.error(e.message)}))}Object(o.useEffect)((function(){f()}),[]);var m=Object(w.jsx)("div",{children:Object(w.jsxs)("a",{href:null===c||void 0===c?void 0:c.profileurl,children:[Object(w.jsx)("img",{src:null===c||void 0===c?void 0:c.avatar}),null===c||void 0===c?void 0:c.personaname]})}),O=Object(w.jsx)("div",{className:"flexColumn",children:l&&l.map((function(e){return Object(w.jsx)($,{componentRoot:Object(w.jsxs)("div",{className:"gameInfo flexRow",children:[Object(w.jsx)("div",{children:Object(w.jsx)("img",{src:"".concat("https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/apps/").concat(e.appid,"/").concat(e.img_icon_url,".jpg                  ")})}),Object(w.jsx)("div",{children:e.name})]}),componentDetail:Object(w.jsx)(ne,Object(s.a)({},e)),link:"".concat("https://steamcommunity.com/app/").concat(e.appid)},e.appid)}))});return Object(w.jsx)("div",{children:Object(w.jsx)(Z,{id:e.id,tabId:e.tabId,config:{},header:m,body:O,refreshFunction:f,onDeleteButtonClicked:e.onDeleteButtonClicked})})}var ae=n(27),ie=n(245);n(405),n(406);function se(e){var t=Object(o.useState)(e.calendarUrls||[]),n=Object(r.a)(t,2),c=n[0],a=n[1],i=function(e){a(c.map((function(t,n){var c;return n.toString()===(null===(c=e.target)||void 0===c?void 0:c.id)?e.target.value:t})))};return Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{children:[c&&c.map((function(e,t){return Object(w.jsxs)("div",{children:[Object(w.jsx)("input",{id:t.toString(),onChange:i,value:e,placeholder:"Saisissez une URL"}),Object(w.jsx)("button",{className:"removeCalendarUrl btn btn-danger",onClick:function(){return t=e,void a(c.filter((function(e){return e!==t})));var t},children:"Supprimer"})]},t)})),Object(w.jsx)("button",{id:"addCalendarUrl",className:"btn btn-primary",onClick:function(){a(c.concat(""))},children:"Ajouter"})]}),Object(w.jsx)("button",{id:"validateCalendarUrls",onClick:function(){e.onConfigSubmitted(c)},disabled:!c||(null===c||void 0===c?void 0:c.length)<1,className:"btn btn-success",children:"Valider"})]})}var re=n(258),oe=n(257),de=n(250),le=n(251),ue=n(572),je=n(159);function be(e){var t=Object(o.useState)(e.calendars),n=Object(r.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)([]),s=Object(r.a)(i,2),d=s[0],l=s[1],u={fr:ue.a},j=Object(je.b)({format:re.a,parse:oe.a,startOfWeek:de.a,getDay:le.a,locales:u});function b(){l([]),null===c||void 0===c||c.map((function(e){g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/?url=").concat(e),x()).then((function(e){var t=ie.parseICS(e.data);l((function(e){return e.concat.apply(e,Object(ae.a)(Object.keys(t).map((function(e){var n,c,a=t[e];return{title:a.summary,start:a.start,end:a.end,allDay:0===(null===(n=a.end)||void 0===n?void 0:n.getHours())&&0===(null===(c=a.start)||void 0===c?void 0:c.getHours())}}))))}))})).catch((function(e){Y.error(e)}))}))}Object(o.useEffect)((function(){b()}),[c]);var h=Object(w.jsx)("div",{children:"Calendar"}),f=Object(w.jsx)("div",{children:Object(w.jsx)(je.a,{localizer:j,culture:"fr",events:d,startAccessor:"start",endAccessor:"end",defaultView:"month",popup:!0,style:{height:500}})});return Object(w.jsx)("div",{children:Object(w.jsx)(Z,{id:e.id,tabId:e.tabId,config:{calendars:c},header:h,body:f,editModeComponent:Object(w.jsx)(se,{calendarUrls:c,onConfigSubmitted:function(t){M(e.id,{calendars:t}).then((function(){t===c&&b(),a(t)})).catch((function(e){Y.error(e.message)}))}}),refreshFunction:b,onDeleteButtonClicked:e.onDeleteButtonClicked})})}var he=n(252),fe=n.n(he);function me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Date(1e3*e+1e3*t)}function Oe(e){var t=-60*(new Date).getTimezoneOffset();if(Math.abs(e)===Math.abs(t))return 0;var n=Math.abs(e)+Math.abs(t);return e<t?-n:n}n(427);function pe(e){var t=document.createElement("div");return t.innerHTML=e||"",t.textContent||t.innerText||""}var ve=function(e){return Object(w.jsxs)("div",{className:"article",children:[Object(w.jsx)("div",{className:"articleTitle",children:Object(w.jsx)("a",{href:e.link,children:e.title})}),Object(w.jsx)("div",{className:"articleContent",children:pe(e.content)||pe(e.description)}),Object(w.jsxs)("div",{className:"articlePubDate",children:["Publi\xe9 le ",(t=e.pubDate||"",new Date(t).toLocaleString("fr"))," ",e.author&&"par "+e.author]})]});var t};n(428);function ge(e){var t=Object(o.useState)(e.url),n=Object(r.a)(t,2),c=n[0],a=n[1];return Object(w.jsxs)("div",{children:[Object(w.jsx)("input",{id:"rssFeedUrl",name:"url",onChange:function(e){return a(e.target.value)},value:c,placeholder:"Saisissez l'URL du flux RSS"}),Object(w.jsx)("button",{onClick:function(){c&&e.onUrlSubmitted(c)},disabled:!c||(null===c||void 0===c?void 0:c.length)<1,className:"btn btn-success",children:"Valider"})]})}n(429);function xe(e){var t=Object(o.useState)([]),n=Object(r.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)(e.url),d=Object(r.a)(i,2),l=d[0],u=d[1],j=Object(o.useState)(""),b=Object(r.a)(j,2),h=b[0],f=b[1],m=Object(o.useState)(),O=Object(r.a)(m,2),p=O[0],v=O[1],k=Object(o.useState)(""),y=Object(r.a)(k,2),N=y[0],S=y[1],C=Object(o.useState)(""),D=Object(r.a)(C,2),E=D[0],R=D[1],_=new fe.a;function A(){l&&g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/?url=").concat(l),x()).then((function(e){_.parseString(e.data).then((function(e){var t=e;f(t.description),a(t.items),v(t.image),S(t.link),R(t.title)}))})).catch((function(e){Y.error(e.message)}))}function T(){a([]),A()}function B(e,t){var n=e?new Date(e).toLocaleTimeString("fr",{hour:"2-digit",minute:"2-digit"}):"";return Object(w.jsxs)("div",{className:"rssArticle",children:[n," ",t]})}Object(o.useEffect)((function(){A()}),[l]);var I,L=Object(w.jsx)("div",{className:"rssWidgetTitle",children:Object(w.jsxs)("a",{href:N,className:"flexRow",children:[p&&Object(w.jsx)("div",{children:Object(w.jsx)("img",{className:"imgLogoRSS",src:null===p||void 0===p?void 0:p.url,alt:"logo"})}),Object(w.jsx)("div",{className:"rssTitle",children:E})]})}),W=Object(w.jsx)("div",{children:l&&c&&Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{className:"rssDescription",children:h}),Object(w.jsx)("div",{className:"feed",children:(I=c,I.map((function(e){return Object(w.jsx)($,{componentRoot:B(e.pubDate,e.title),componentDetail:Object(w.jsx)(ve,Object(s.a)({},e)),link:e.link},e.guid)})))})]})});return Object(w.jsx)("div",{children:Object(w.jsx)(Z,{id:e.id,tabId:e.tabId,config:{url:l},header:L,body:W,editModeComponent:Object(w.jsx)(ge,{url:l,onUrlSubmitted:function(t){M(e.id,{url:t}).then((function(){u(t),T()})).catch((function(e){Y.error(e.message)}))}}),refreshFunction:T,onDeleteButtonClicked:e.onDeleteButtonClicked})})}var we=n(253);function ke(e,t){var n=Object(o.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(c){return Y.error(c),t}})),c=Object(r.a)(n,2),a=c[0],i=c[1];return[a,function(t){try{var n=t instanceof Function?t(a):t;i(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(c){Y.error(c)}}]}function ye(e){return Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:Object(w.jsxs)("a",{href:"https://www.strava.com/activities/".concat(e.id),children:[Object(re.a)(new Date(e.start_date_local),"dd MMM")," ",e.name]})}),Object(w.jsxs)("div",{children:["Distance : ",Math.round(1e3*e.distance)/1e4," kms"]}),Object(w.jsxs)("div",{children:["Dur\xe9e : ",e.moving_time/60," mins"]}),Object(w.jsxs)("div",{children:["Denivel\xe9 : ",e.total_elevation_gain]}),Object(w.jsxs)("div",{children:["Troph\xe9es : ",e.achievement_count]}),Object(w.jsxs)("div",{children:["Vitesse moyenne : ",e.average_speed]}),Object(w.jsxs)("div",{children:["Vitesse max : ",e.max_speed]}),Object(w.jsxs)("div",{children:["Kudos : ",e.kudos_count]}),Object(w.jsxs)("div",{children:["Commentaires : ",e.comment_count]})]})}var Ne=n(564),Se=n(565),Ce=n(108);function De(e){var t=Object(o.useState)([]),n=Object(r.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)(),d=Object(r.a)(i,2),l=d[0],j=d[1],b=ke("strava_token",null),h=Object(r.a)(b,2),f=h[0],m=h[1],O=ke("strava_refresh_token",null),p=Object(r.a)(O,2),v=p[0],x=p[1],k=ke("strava_token_expires_at",null),y=Object(r.a)(k,2),N=y[0],S=y[1],C=Object(P.e)().search;function D(){a([]),f&&g.a.get("https://www.strava.com/api/v3/athlete",{headers:{Authorization:"Bearer ".concat(f)}}).then((function(e){j(e.data)})).catch((function(e){Y.error(e.message)})),f&&N&&Object(Se.a)(new Date(1e3*N),new Date)?g.a.get("https://www.strava.com/api/v3/athlete/activities?page=1&per_page=".concat(20),{headers:{Authorization:"Bearer ".concat(f)}}).then((function(e){a(e.data.reverse())})).catch((function(e){Y.error(e.message)})):E()}function E(){v?g.a.post("https://www.strava.com/oauth/token",{client_id:"30391",client_secret:"66cf349fa75b4f87701342463c9d69bea1acc1ed",refresh_token:v,grant_type:"refresh_token"}).then((function(e){m(e.data.access_token),x(e.data.refresh_token),S(e.data.expires_at),j(e.data.athlete)})).catch((function(e){Y.error(e.message)})):Y.error("No refresh token")}function R(){return c.reduce((function(e,t){var n=Object(re.a)(new Date(t.start_date_local),"yyyy-MM");return e[n]||(e[n]=[]),e[n].push(Math.round(1e3*t.distance)/1e4),e}),[])}function _(){var e=R();return Object.keys(e).map((function(t){return{x:new Date(t),y:Math.round(e[t].reduce((function(e,t){return e+t})))}}))}Object(o.useEffect)((function(){var e=we.parse(C);e&&e.code&&function(e){g.a.post("https://www.strava.com/oauth/token",{client_id:"30391",client_secret:"66cf349fa75b4f87701342463c9d69bea1acc1ed",code:e,grant_type:"authorization_code"}).then((function(e){m(e.data.access_token),x(e.data.refresh_token),S(e.data.expires_at),j(e.data.athlete)})).catch((function(e){Y.error(e.message)}))}(e.code.toString());f&&v&&!Object(Ne.a)(new Date(1e3*N),new Date)||E()}),[]),Object(o.useEffect)((function(){f&&D()}),[f]);var A=Object(w.jsx)("div",{children:Object(w.jsxs)("a",{href:"https://www.strava.com/athletes/".concat(null===l||void 0===l?void 0:l.id),children:[Object(w.jsx)("img",{src:null===l||void 0===l?void 0:l.profile_medium}),null===l||void 0===l?void 0:l.firstname," ",null===l||void 0===l?void 0:l.lastname]})}),T=Object(w.jsxs)("div",{className:"flexColumn",children:[f&&v&&N&&Object(Se.a)(new Date(1e3*N),new Date)&&Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{style:{height:"20vh",overflowY:"scroll"},children:c.slice().reverse().map((function(e){return Object(w.jsx)($,{componentRoot:"".concat(Object(re.a)(new Date(e.start_date_local),"dd MMM"),"  ").concat(e.name,"  ").concat(Math.round(1e3*e.distance)/1e6," kms"),componentDetail:Object(w.jsx)(ye,Object(s.a)({},e)),link:"https://www.strava.com/activities/".concat(e.id)},e.id)}))}),Object(w.jsx)("div",{style:{minHeight:"25vh",maxHeight:"80vh",flex:"1 0 50%"},children:Object(w.jsx)(Ce.b,{type:"bar",data:{labels:_().map((function(e){return Object(re.a)(e.x,"MMM yyyy")})),datasets:[{label:"Distance (kms)",backgroundColor:"orange",data:_(),yAxisID:"kms",order:2},{label:"Activit\xe9s",type:"line",backgroundColor:"darkgreen",data:Object.keys(R()).map((function(e){return{x:new Date(e),y:R()[e].length}})),yAxisID:"activities",order:1}]},options:{scales:{y:[{id:"kms",type:"linear",position:"left"},{id:"activities",type:"linear",position:"right"}]}}})})]}),(!f||!v||N&&Object(Ne.a)(new Date(1e3*N),new Date))&&Object(w.jsx)("a",{href:"https://www.strava.com/oauth/authorize?client_id=".concat("30391","&redirect_uri=").concat("https://arnaudflaesch.github.io/Dash-Web/","&response_type=code&scope=read,activity:read"),children:Object(w.jsx)(u.a,{children:"Se connecter"})})]});return Object(w.jsx)("div",{children:Object(w.jsx)(Z,{id:e.id,tabId:e.tabId,config:{},header:A,body:T,refreshFunction:D,onDeleteButtonClicked:e.onDeleteButtonClicked})})}n(544);function Ee(e){var t=Object(o.useState)(e.city||""),n=Object(r.a)(t,2),c=n[0],a=n[1];return Object(w.jsxs)("div",{children:[Object(w.jsx)("input",{id:"cityNameInput",name:"city",onChange:function(e){return a(e.target.value)},value:c,placeholder:"Saisissez de nom de la ville"}),Object(w.jsx)("button",{id:"validateButton",className:"btn btn-success",onClick:function(){e.onConfigSubmitted(c)},disabled:!c||(null===c||void 0===c?void 0:c.length)<1,children:"Valider"})]})}n(545);var Re,_e=function(e){var t,n,c;return Object(w.jsxs)("div",{className:"forecast",children:[Object(w.jsx)("div",{children:me(e.dt,Oe(e.city.timezone)).toLocaleString("fr",{weekday:"short",day:"numeric",hour:"2-digit"})}),Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)("div",{children:Object(w.jsx)("img",{src:"https://openweathermap.org/img/wn/".concat(null===(t=e.weather[0])||void 0===t?void 0:t.icon,"@2x.png"),className:"smallImage",title:null===(n=e.weather[0])||void 0===n?void 0:n.description,alt:null===(c=e.weather[0])||void 0===c?void 0:c.description})}),Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-thermometer-three-quarters fa-sm mr10",style:{color:"crimson"}}),e.main.temp_max,"\xb0"]}),Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-thermometer-quarter fa-sm mr10",style:{color:"blue"}}),e.main.temp_min,"\xb0"]}),Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-tint fa-sm mr10",style:{color:"lightblue"}}),e.main.humidity,"%"]})]})]})]})};n(546);function Ae(e){var t="http://api.openweathermap.org/data/2.5/",n="?units=metric&lang=fr&appid=",c=Object(o.useState)(e.city),a=Object(r.a)(c,2),i=a[0],d=a[1],l=Object(o.useState)(),u=Object(r.a)(l,2),j=u[0],b=u[1],h=Object(o.useState)(),f=Object(r.a)(h,2),m=f[0],O=f[1],p=Object(o.useState)(),v=Object(r.a)(p,2),k=v[0],y=v[1],N=Object(o.useState)(Re.TODAY),S=Object(r.a)(N,2),C=S[0],D=S[1];function E(){i&&(g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/"),Object(s.a)(Object(s.a)({},x()),{},{params:{url:"".concat(t).concat("weather").concat(n).concat("d10750704319701c3f9436134add4d7d","&q=").concat(i)}})).then((function(e){b(e.data)})).catch((function(e){Y.error(e)})),g.a.get("".concat("https://dash-webservices.herokuapp.com","/proxy/"),Object(s.a)(Object(s.a)({},x()),{},{params:{url:"".concat(t).concat("forecast").concat(n).concat("d10750704319701c3f9436134add4d7d","&q=").concat(i)}})).then((function(e){O(e.data.list),y(e.data.city)})).catch((function(e){Y.error(e.message)})))}function R(){b(void 0),O(void 0),y(void 0),E()}function _(){if(!k||!m)return[];switch(C){case Re.WEEK:return m.filter((function(e){return 17===me(e.dt,Oe(k.timezone)).getHours()}));case Re.TOMORROW:return m.filter((function(e){return new Date(1e3*e.dt).getDay()===new Date(+new Date+864e5).getDay()&&new Date(1e3*e.dt).getHours()>=7}));case Re.TODAY:default:return m.filter((function(e){return new Date(1e3*e.dt).getDay()===(new Date).getDay()&&new Date(1e3*e.dt).getHours()>=7}))}}Object(o.useEffect)((function(){E()}),[i]);var A=Object(w.jsxs)("div",{children:["La m\xe9t\xe9o aujourd'hui \xe0 ",null===k||void 0===k?void 0:k.name]}),T=Object(w.jsxs)("div",{children:[k&&j&&j.weather&&Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)("div",{children:Object(w.jsx)("img",{style:{width:"80px"},src:"https://openweathermap.org/img/wn/".concat(j.weather[0].icon,"@2x.png"),title:j.weather[0].description,alt:j.weather[0].description})}),Object(w.jsxs)("div",{className:"flexRow",style:{placeItems:"center"},children:[Object(w.jsxs)("div",{className:"flexColumn mr5",children:[Object(w.jsx)("div",{children:j.weather[0].description}),Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-thermometer-three-quarters fa-md"})," ",j.main.temp,"\xb0"]})]}),Object(w.jsxs)("div",{className:"flexColumn",children:[Object(w.jsxs)("div",{className:"spaceBetween",children:[Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-sun-o fa-md"})," ",me(j.sys.sunrise,Oe(j.timezone)).toLocaleTimeString("fr")]}),Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-moon-o fa-md"})," ",me(j.sys.sunset,Oe(j.timezone)).toLocaleTimeString("fr")]})]}),Object(w.jsxs)("div",{children:[Object(w.jsx)("i",{className:"fa fa-clock-o fa-md"})," ",me(j.dt,Oe(j.timezone)).toLocaleString("fr")]})]})]})]}),k&&m&&Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)("span",{className:"bold",children:"Pr\xe9visions"}),Object(w.jsxs)("span",{style:{alignContent:"space-between",display:"flex"},children:[Object(w.jsx)("button",{id:"toggleTodayForecast",onClick:function(){D(Re.TODAY)},style:{flex:"1"},className:"btn btn-".concat(C===Re.TODAY?"success":"primary"," mr-5"),children:"Aujourd'hui"}),Object(w.jsx)("button",{id:"toggleTomorrowForecast",onClick:function(){D(Re.TOMORROW)},style:{flex:"1"},className:"btn btn-".concat(C===Re.TOMORROW?"success":"primary"),children:"Demain"}),Object(w.jsx)("button",{id:"toggleWeekForecast",onClick:function(){D(Re.WEEK)},style:{flex:"1"},className:"btn btn-".concat(C===Re.WEEK?"success":"primary"),children:"Semaine"})]})]}),Object(w.jsx)("br",{}),Object(w.jsx)("div",{style:{height:"20vh",maxWidth:"100%"},children:Object(w.jsx)(Ce.a,{type:"line",data:{labels:_().map((function(e){return C===Re.TODAY||C===Re.TOMORROW?Object(re.a)(new Date(1e3*e.dt),"HH"):Object(re.a)(new Date(1e3*e.dt),"EEE dd MMM")})),datasets:[{label:"Temp\xe9rature",borderColor:"orange",data:_().map((function(e){return e.main.temp_max}))},{label:"Ressenti",borderColor:"red",data:_().map((function(e){return e.main.feels_like}))}]},options:{maintainAspectRatio:!1}})}),Object(w.jsx)("div",{className:"flexRow forecastRow",children:k&&m&&_().map((function(e){return Object(w.jsx)("div",{className:"forecastContainer",children:Object(w.jsx)(_e,Object(s.a)(Object(s.a)({},e),{},{city:k}))},e.dt)}))})]})]});return Object(w.jsx)("div",{children:Object(w.jsx)(Z,{id:e.id,tabId:e.tabId,config:{city:k},header:A,body:T,editModeComponent:Object(w.jsx)(Ee,{city:i,onConfigSubmitted:function(t){M(e.id,{city:t}).then((function(){d(t),R()})).catch((function(e){Y.error(e.message)}))}}),refreshFunction:R,onDeleteButtonClicked:e.onDeleteButtonClicked})})}function Te(e){var t=Object(o.useState)([]),n=Object(r.a)(t,2),c=n[0],i=n[1],d=Object(a.c)((function(e){return e.activeTab}));function l(e){switch(e.type){case C.WEATHER:return Object(w.jsx)(Ae,Object(s.a)(Object(s.a)({id:e.id,tabId:e.tab.id},e.data),{},{onDeleteButtonClicked:u}));case C.RSS:return Object(w.jsx)(xe,Object(s.a)(Object(s.a)({id:e.id,tabId:e.tab.id},e.data),{},{onDeleteButtonClicked:u}));case C.CALENDAR:return Object(w.jsx)(be,Object(s.a)(Object(s.a)({id:e.id,tabId:e.tab.id},e.data),{},{onDeleteButtonClicked:u}));case C.STRAVA:return Object(w.jsx)(De,Object(s.a)(Object(s.a)({id:e.id,tabId:e.tab.id},e.data),{},{onDeleteButtonClicked:u}));case C.STEAM:return Object(w.jsx)(ce,Object(s.a)(Object(s.a)({id:e.id,tabId:e.tab.id},e.data),{},{onDeleteButtonClicked:u}));default:return}}function u(e){(function(e){return g.a.delete("".concat("https://dash-webservices.herokuapp.com","/widget/deleteWidget/?id=").concat(e),x())})(e).then((function(t){t&&i(c.filter((function(t){return t.id!==e})))})).catch((function(e){Y.error(e.message)}))}return Object(o.useEffect)((function(){c.length||d!==e.tabId||fetch("".concat("https://dash-webservices.herokuapp.com","/widget/?tabId=").concat(e.tabId),x()).then((function(e){return e.json()})).then((function(e){i(e)})).catch((function(e){Y.error(e.message)}))}),[d]),Object(o.useEffect)((function(){e.newWidget&&i(c.concat([e.newWidget]))}),[null!=e.newWidget&&e.newWidget.id]),Object(w.jsx)(W.a,{tabId:e.tabId,children:Object(w.jsxs)("div",{className:"widgetList",children:[Object(w.jsx)(K,{}),c&&c.length>0&&c.map((function(e){return Object(w.jsx)("div",{className:"widget",children:l(e)},e.id)}))]})})}function Be(){var e=Object(o.useState)([]),t=Object(r.a)(e,2),n=t[0],c=t[1],i=Object(o.useState)(),O=Object(r.a)(i,2),p=O[0],v=O[1],y=Object(o.useState)(!1),C=Object(r.a)(y,2),D=C[0],E=C[1],R=Object(a.c)((function(e){return e.activeTab})),_=Object(a.b)(),A=o.useRef(!1);function T(){var e;(e="Nouvel onglet",g.a.post("".concat("https://dash-webservices.herokuapp.com","/tab/addTab"),{label:e},x())).then((function(e){var t=e.data;c(n.concat(t)),_(L(t.id))}))}function I(){E(!D)}function M(e){n.length>1&&(n[0].id===e?_(L(n[1].id)):_(L(R===e?n[0].id:R))),c(n.filter((function(t){return t.id!==e})))}return Object(o.useEffect)((function(){A.current&&n&&0===n.length&&T()}),[n]),Object(o.useEffect)((function(){fetch("".concat("https://dash-webservices.herokuapp.com","/tab/"),x()).then((function(e){return e.json()})).then((function(e){c(e),e&&e.length>0&&_(L(e[0].id)),A.current=!0})).catch((function(e){Y.error(e.message)}))}),[]),Object(w.jsxs)("div",{className:"dash",children:[!N.getCurrentUser()&&Object(w.jsx)(S,{}),N.getCurrentUser()&&Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)("div",{className:"dashNavbar",children:R&&n.length>0&&Object(w.jsxs)(l.a,{vertical:!0,navbar:!0,children:[Object(w.jsx)(u.a,{id:"openAddWidgetModal",className:"dashNavbarLink",onClick:I,children:Object(w.jsx)("i",{className:"fa fa-plus-circle fa-lg","aria-hidden":"true"})}),Object(w.jsxs)(j.a,{isOpen:D,toggle:I,children:[Object(w.jsx)(b.a,{toggle:I,children:"Ajouter un widget"}),Object(w.jsx)(h.a,{children:Object(w.jsx)(B,{onWidgetAdded:function(e){R&&function(e,t){return g.a.post("".concat("https://dash-webservices.herokuapp.com","/widget/addWidget"),{type:e,tab:{id:t}},x())}(e.currentTarget.value,R).then((function(e){if(e){var t=e.data;v(t)}})).catch((function(e){Y.error(e.message)}))}})}),Object(w.jsx)(f.a,{children:Object(w.jsx)(u.a,{id:"closeAddWidgetModal",color:"primary",onClick:I,children:"Fermer"})})]})]})}),Object(w.jsxs)("div",{className:"flexColumn tabsBar",children:[Object(w.jsx)(l.a,{tabs:!0,children:Object(w.jsxs)("div",{className:"flexRow",children:[Object(w.jsx)(d.a,{onDragEnd:function(e){e.destination&&function(e){return g.a.post("".concat("https://dash-webservices.herokuapp.com","/tab/updateTabs"),e,x())}(function(e,t,n){var c=Array.from(e),a=c.splice(t,1),i=Object(r.a)(a,1)[0];return c.splice(n,0,i),c}(n,e.source.index,e.destination.index).map((function(e,t){return e.tabOrder=t,e}))).then((function(e){c(e.data)}))},children:Object(w.jsx)(d.c,{droppableId:"droppable",direction:"horizontal",children:function(e){return Object(w.jsxs)("div",Object(s.a)(Object(s.a)({className:"flexRow"},e.droppableProps),{},{ref:e.innerRef,children:[n.length>0&&n.map((function(e,t){return Object(w.jsx)(d.b,{draggableId:e.id.toString(),index:t,children:function(t){return Object(w.jsx)("div",Object(s.a)(Object(s.a)(Object(s.a)({ref:t.innerRef},t.draggableProps),t.dragHandleProps),{},{className:"tab ".concat(e.id===R?"selectedItem":""),children:Object(w.jsx)(k,{tab:e,onTabClicked:function(){return function(e){R!==e&&_(L(e))}(e.id)},onTabDeleted:M})}),e.id)}},e.id)})),e.placeholder]}))}})}),Object(w.jsx)(u.a,{onClick:T,id:"addNewTabButton",className:"fa fa-plus-circle fa-lg"}),Object(w.jsx)(u.a,{onClick:N.logout,className:"btn btn-primary",children:"Se d\xe9connecter"})]})}),Object(w.jsx)(m.a,{activeTab:R,children:n.length>0&&n.map((function(e){return Object(w.jsx)(Te,{newWidget:(t=e.id,p&&t===p.tab.id?p:void 0),tabId:e.id},e.id);var t}))})]})]})]})}!function(e){e[e.TODAY=0]="TODAY",e[e.TOMORROW=1]="TOMORROW",e[e.WEEK=2]="WEEK"}(Re||(Re={}));n(547);var Ie=n(43),Le={activeTab:-1},Me=Object(Ie.d)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:var n=t.payload.id;return Object(s.a)(Object(s.a)({},e),{},{activeTab:n});default:return e}})),We=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Fe(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.render(Object(w.jsx)(a.a,{store:Me,children:Object(w.jsx)(i.a,{children:Object(w.jsx)(Be,{})})}),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat(".","/service-worker.js");We?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Fe(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Fe(e)}))}}()}},[[548,1,2]]]);
//# sourceMappingURL=main.ac4cd2ec.chunk.js.map